!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=Object.prototype.hasOwnProperty,e=Object.prototype.toString,f=function(a){return"function"==typeof Array.isArray?Array.isArray(a):"[object Array]"===e.call(a)},g=function(a){if(!a||"[object Object]"!==e.call(a))return!1;var b=d.call(a,"constructor"),c=a.constructor&&a.constructor.prototype&&d.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!b&&!c)return!1;var f;for(f in a);return"undefined"==typeof f||d.call(a,f)};b.exports=function h(){var a,b,c,d,e,i,j=arguments[0],k=1,l=arguments.length,m=!1;for("boolean"==typeof j?(m=j,j=arguments[1]||{},k=2):("object"!=typeof j&&"function"!=typeof j||null==j)&&(j={});l>k;++k)if(a=arguments[k],null!=a)for(b in a)c=j[b],d=a[b],j!==d&&(m&&d&&(g(d)||(e=f(d)))?(e?(e=!1,i=c&&f(c)?c:[]):i=c&&g(c)?c:{},j[b]=h(m,i,d)):"undefined"!=typeof d&&(j[b]=d));return j}},{}],2:[function(a,b,c){function d(){}function e(a){var b={}.toString.call(a);switch(b){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function f(a){return a===Object(a)}function g(a){if(!f(a))return a;var b=[];for(var c in a)null!=a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function h(a){for(var b,c,d={},e=a.split("&"),f=0,g=e.length;g>f;++f)c=e[f],b=c.split("="),d[decodeURIComponent(b[0])]=decodeURIComponent(b[1]);return d}function i(a){var b,c,d,e,f=a.split(/\r?\n/),g={};f.pop();for(var h=0,i=f.length;i>h;++h)c=f[h],b=c.indexOf(":"),d=c.slice(0,b).toLowerCase(),e=r(c.slice(b+1)),g[d]=e;return g}function j(a){return a.split(/ *; */).shift()}function k(a){return p(a.split(/ *; */),function(a,b){var c=b.split(/ *= */),d=c.shift(),e=c.shift();return d&&e&&(a[d]=e),a},{})}function l(a,b){b=b||{},this.req=a,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this.setStatusProperties(this.xhr.status),this.header=this.headers=i(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this.parseBody(this.text?this.text:this.xhr.response):null}function m(a,b){var c=this;o.call(this),this._query=this._query||[],this.method=a,this.url=b,this.header={},this._header={},this.on("end",function(){var a=null,b=null;try{b=new l(c)}catch(d){return a=new Error("Parser is unable to parse the response"),a.parse=!0,a.original=d,c.callback(a)}if(c.emit("response",b),a)return c.callback(a,b);if(b.status>=200&&b.status<300)return c.callback(a,b);var e=new Error(b.statusText||"Unsuccessful HTTP response");e.original=a,e.response=b,e.status=b.status,c.callback(a||e,b)})}function n(a,b){return"function"==typeof b?new m("GET",a).end(b):1==arguments.length?new m("GET",a):new m(a,b)}var o=a("emitter"),p=a("reduce"),q="undefined"==typeof window?this||self:window;n.getXHR=function(){if(!(!q.XMLHttpRequest||q.location&&"file:"==q.location.protocol&&q.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}return!1};var r="".trim?function(a){return a.trim()}:function(a){return a.replace(/(^\s*|\s*$)/g,"")};n.serializeObject=g,n.parseString=h,n.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},n.serialize={"application/x-www-form-urlencoded":g,"application/json":JSON.stringify},n.parse={"application/x-www-form-urlencoded":h,"application/json":JSON.parse},l.prototype.get=function(a){return this.header[a.toLowerCase()]},l.prototype.setHeaderProperties=function(a){var b=this.header["content-type"]||"";this.type=j(b);var c=k(b);for(var d in c)this[d]=c[d]},l.prototype.parseBody=function(a){var b=n.parse[this.type];return b&&a&&(a.length||a instanceof Object)?b(a):null},l.prototype.setStatusProperties=function(a){1223===a&&(a=204);var b=a/100|0;this.status=a,this.statusType=b,this.info=1==b,this.ok=2==b,this.clientError=4==b,this.serverError=5==b,this.error=4==b||5==b?this.toError():!1,this.accepted=202==a,this.noContent=204==a,this.badRequest=400==a,this.unauthorized=401==a,this.notAcceptable=406==a,this.notFound=404==a,this.forbidden=403==a},l.prototype.toError=function(){var a=this.req,b=a.method,c=a.url,d="cannot "+b+" "+c+" ("+this.status+")",e=new Error(d);return e.status=this.status,e.method=b,e.url=c,e},n.Response=l,o(m.prototype),m.prototype.use=function(a){return a(this),this},m.prototype.timeout=function(a){return this._timeout=a,this},m.prototype.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},m.prototype.abort=function(){return this.aborted?void 0:(this.aborted=!0,this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this)},m.prototype.set=function(a,b){if(f(a)){for(var c in a)this.set(c,a[c]);return this}return this._header[a.toLowerCase()]=b,this.header[a]=b,this},m.prototype.unset=function(a){return delete this._header[a.toLowerCase()],delete this.header[a],this},m.prototype.getHeader=function(a){return this._header[a.toLowerCase()]},m.prototype.type=function(a){return this.set("Content-Type",n.types[a]||a),this},m.prototype.accept=function(a){return this.set("Accept",n.types[a]||a),this},m.prototype.auth=function(a,b){var c=btoa(a+":"+b);return this.set("Authorization","Basic "+c),this},m.prototype.query=function(a){return"string"!=typeof a&&(a=g(a)),a&&this._query.push(a),this},m.prototype.field=function(a,b){return this._formData||(this._formData=new q.FormData),this._formData.append(a,b),this},m.prototype.attach=function(a,b,c){return this._formData||(this._formData=new q.FormData),this._formData.append(a,b,c),this},m.prototype.send=function(a){var b=f(a),c=this.getHeader("Content-Type");if(b&&f(this._data))for(var d in a)this._data[d]=a[d];else"string"==typeof a?(c||this.type("form"),c=this.getHeader("Content-Type"),"application/x-www-form-urlencoded"==c?this._data=this._data?this._data+"&"+a:a:this._data=(this._data||"")+a):this._data=a;return!b||e(a)?this:(c||this.type("json"),this)},m.prototype.callback=function(a,b){var c=this._callback;this.clearTimeout(),c(a,b)},m.prototype.crossDomainError=function(){var a=new Error("Origin is not allowed by Access-Control-Allow-Origin");a.crossDomain=!0,this.callback(a)},m.prototype.timeoutError=function(){var a=this._timeout,b=new Error("timeout of "+a+"ms exceeded");b.timeout=a,this.callback(b)},m.prototype.withCredentials=function(){return this._withCredentials=!0,this},m.prototype.end=function(a){var b=this,c=this.xhr=n.getXHR(),f=this._query.join("&"),g=this._timeout,h=this._formData||this._data;this._callback=a||d,c.onreadystatechange=function(){if(4==c.readyState){var a;try{a=c.status}catch(d){a=0}if(0==a){if(b.timedout)return b.timeoutError();if(b.aborted)return;return b.crossDomainError()}b.emit("end")}};var i=function(a){a.total>0&&(a.percent=a.loaded/a.total*100),b.emit("progress",a)};this.hasListeners("progress")&&(c.onprogress=i);try{c.upload&&this.hasListeners("progress")&&(c.upload.onprogress=i)}catch(j){}if(g&&!this._timer&&(this._timer=setTimeout(function(){b.timedout=!0,b.abort()},g)),f&&(f=n.serializeObject(f),this.url+=~this.url.indexOf("?")?"&"+f:"?"+f),c.open(this.method,this.url,!0),this._withCredentials&&(c.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof h&&!e(h)){var k=n.serialize[this.getHeader("Content-Type")];k&&(h=k(h))}for(var l in this.header)null!=this.header[l]&&c.setRequestHeader(l,this.header[l]);return this.emit("request",this),c.send(h),this},n.Request=m,n.get=function(a,b,c){var d=n("GET",a);return"function"==typeof b&&(c=b,b=null),b&&d.query(b),c&&d.end(c),d},n.head=function(a,b,c){var d=n("HEAD",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},n.del=function(a,b){var c=n("DELETE",a);return b&&c.end(b),c},n.patch=function(a,b,c){var d=n("PATCH",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},n.post=function(a,b,c){var d=n("POST",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},n.put=function(a,b,c){var d=n("PUT",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},b.exports=n},{emitter:3,reduce:4}],3:[function(a,b,c){function d(a){return a?e(a):void 0}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}b.exports=d,d.prototype.on=d.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){d.off(a,c),b.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},c.fn=b,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{}],4:[function(a,b,c){b.exports=function(a,b,c){for(var d=0,e=a.length,f=3==arguments.length?c:a[d++];e>d;)f=b.call(null,f,a[d],++d,a);return f}},{}],5:[function(a,b,c){(function(b){var c=b.AV=b.AV||{};c.realtime=a("./realtime")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./realtime":6}],6:[function(a,b,c){(function(d){var e=a("superagent"),f=a("extend"),g="2.2.0",h={heartbeatsTime:6e4,WebSocket:void 0};"undefined"!=typeof window&&"undefined"!=typeof window.WebSocket&&(h.WebSocket=window.WebSocket);var i={},j={},k={open:"open",reuse:"reuse",close:"close",create:"create",join:"join",left:"left",message:"message",receipt:"receipt",update:"update",error:"error"},l=function(a){var b=function(b,c,d,e){var f,g,h,i=[];switch("string"==typeof c?i.push(c):i=c,f={cid:b,members:i,serialId:j.getSerialId(a)},e){case"add":h="conv-added",j.convAdd(a,f);break;case"remove":h="conv-removed",j.convRemove(a,f)}return g=function(b){b.i===f.serialId&&(d&&d(b),a.ec.off(h,g))},a.ec.on(h,g),this};return{id:"",attr:{},add:function(a,c){return b(this.id,a,c,"add"),this},remove:function(a,c){return b(this.id,a,c,"remove"),this},join:function(b){return this.add(a.options.peerId,b),this},leave:function(b){return this.remove(a.options.peerId,b),this},send:function(b,c,d){var e,f={},g=this;switch(arguments.length){case 2:e=c;break;case 3:f=c,e=d}if(f.cid=g.id,f.serialId=j.getSerialId(a),f.type?f.data=j.setMediaMsg(a,f.type,b):"string"==typeof b?f.data=b:f.data=JSON.stringify(b),f.receipt&&(f.receipt=1),!f["transient"]){var h=function(b){b.i===f.serialId&&(e&&e(b),a.ec.off("ack",h))};a.ec.on("ack",h)}return j.send(a,f,e),this},log:function(b,c){var d={};switch(arguments.length){case 1:c=b;break;case 2:d=b}d.cid=d.cid||this.id,d.serialId=d.serialId||j.getSerialId(a);var e=function(b){if(b.i===d.serialId){if(c){for(var f=0,g=b.logs.length;g>f;f++)b.logs[f].data=j.getMediaMsg(a,b.logs[f].data),b.logs[f].fromPeerId=b.logs[f].from,b.logs[f].msg=b.logs[f].data;c(b.logs)}a.ec.off("logs",e)}};return a.ec.on("logs",e),j.convLog(a,d),this},receive:function(b){var c=this.id;return a.ec.on(k.message,function(a){c===a.cid&&b(a)}),this},receipt:function(b){var c=this.id;return a.ec.on(k.receipt,function(a){c===a.cid&&b(a)}),this},list:function(b){var c={},d=this.id;c.where={m:a.options.peerId,objectId:d},c.serialId=j.getSerialId(a);var e=function(d){d.i===c.serialId&&(b&&b(d.results.length?d.results[0].m:[]),a.ec.off("conv-results",e))};return a.ec.on("conv-results",e),j.convQuery(a,c),this},count:function(b){var c=this.id,d={cid:c,serialId:j.getSerialId(a)},e=function(c){c.i===d.serialId&&(b&&b(c.count),a.ec.off("conv-result",e))};return a.ec.on("conv-result",e),j.convCount(a,d),this},update:function(b,c){var d=this.id,e={cid:d,data:b,serialId:j.getSerialId(a)},f=function(b){b.i===e.serialId&&(c&&c(b),a.ec.off("conv-updated",f))};return a.ec.on("conv-updated",f),j.convUpdate(a,e),this}}},m=function(){var a={options:void 0,ws:void 0,ec:void 0,conv:{},openFlag:!1,closeFlag:!1,reuseTimer:void 0,reuseFlag:!1,serialId:2015};return{clientId:"",cache:a,open:function(a){var b=this,c=this.cache;return c.closeFlag=!1,j.getServer(c,c.options,function(a){a&&j.connect(c,{server:c.server})}),a&&c.ec.once(k.open,a),c.ec.once(k.reuse,function(){c.reuseTimer&&clearTimeout(c.reuseTimer),c.reuseTimer=setTimeout(function(){b.open()},5e3)}),this},close:function(){var a=this.cache;if(!a.openFlag)throw new Error("Must call after open() has successed.");return a.closeFlag=!0,j.closeSession(a),a.ws.close(),this},on:function(a,b){return this.cache.ec.on(a,b),this},once:function(a,b){return this.cache.ec.once(a,b),this},emit:function(a,b){return this.cache.ec.emit(a,b),this},off:function(a,b){return this.cache.ec.off(a,b),this},room:function(a,b){var c=this.cache;if(!c.openFlag)throw new Error("Must call after open() has successed.");var d;if("string"==typeof a){var e=a;d=c.conv[e]?c.conv[e]:l(c),this.query({where:{objectId:e}},function(a){a.length&&(d.id=e,d.name=a[0].name,d.attr=a[0].attr,c.conv[e]=d),b&&b(a.length?d:null)})}else{if(!a)throw new Error("Createing room must have a callback function.");var f;"function"==typeof a?b=a:f=a,f={name:f.name||"",members:f.members||[],attr:f.attr||{},"transient":f["transient"]||!1,serialId:j.getSerialId(c)},d=l(c),j.startConv(c,f,b);var g=function(a){a.i===f.serialId&&(d.id=a.cid,d.name=f.name,d.attr=f.attr,c.conv[d.id]=d,b&&b(d),c.ec.emit(k.create,a),c.ec.off("conv-started",g))};c.ec.on("conv-started",g)}return d},conv:function(){return this.room.apply(this,arguments)},query:function(a,b){var c=this.cache;if(!c.openFlag)throw new Error("Must call after open() has successed.");var d={};switch(arguments.length){case 1:b=a;break;case 2:d=a}d.serialId=j.getSerialId(c);var e=function(a){a.i===d.serialId&&(b&&b(a.results),c.ec.off("conv-results",e))};return c.ec.on("conv-results",e),j.convQuery(c,d),this},ping:function(a,b){var c=this.cache;if(!c.openFlag)throw new Error("Must call after open() has successed.");if(!b)throw new Error("Ping must have callback.");var d=[];"string"==typeof a?d.push(a):d=a;var e={serialId:j.getSerialId(c),peerIdList:d},f=function(a){a.i===e.serialId&&(b(a.onlineSessionPeerIds),c.ec.off("session-query-result",f))};return c.ec.on("session-query-result",f),j.querySession(c,e),this}}},n=function(a,b){if("object"!=typeof a)throw new Error("realtime need a argument at least.");if(!a.appId)throw new Error("Options must have appId.");if(h.WebSocket){var c=h.WebSocket.loadFlashPolicyFile?!1:!0;a={appId:a.appId,peerId:a.clientId,encodeHTML:a.encodeHTML||!1,auth:a.auth,secure:"undefined"==typeof a.secure?c:a.secure,region:a.region||"cn"};var d=m();return d.clientId=a.clientId,d.cache.options=a,d.cache.ec=i.eventCenter(),d.cache.authFun=a.auth,d.open(b),d}console.error("Browser must support WebSocket, please read LeanCloud doc and use plugin.")};n.version=g,n._tool=i,n._engine=j,n.config=function(a){f(h,a)},j.wsOpen=function(a){j.bindEvent(a),j.openSession(a,{serialId:j.getSerialId(a)}),j.heartbeats(a),j.guard(a)},j.wsClose=function(a,b){a.ec.emit(k.close,b)},j.wsMessage=function(a,b){var c=JSON.parse(b.data);if(c.cmd){var d=c.cmd;c.op&&(d+="-"+c.op),a.ec.emit(d,c)}},j.wsError=function(a,b){throw a.ec.emit(k.error,b),b},j.wsSend=function(a,b){if(!a.closeFlag){if(!a.ws)throw new Error('The realtimeObject must opened first. Please listen to the "open" event.');b.peerId=a.options.peerId,a.ws.send(JSON.stringify(b))}},j.createSocket=function(a,b){a.ws&&a.ws.close();var c=new h.WebSocket(b);a.ws=c,c.addEventListener("open",function(){j.wsOpen(a)}),c.addEventListener("close",function(b){j.wsClose(a,b)}),c.addEventListener("message",function(b){j.wsMessage(a,b)}),c.addEventListener("error",function(b){j.wsError(a,b)})},j.heartbeats=function(a){if(!a.openFlag){var b;a.ws.addEventListener("message",function(){b&&clearTimeout(b),b=setTimeout(function(){a.ws.send("{}")},h.heartbeatsTime)})}},j.guard=function(a){if(!a.openFlag){var b,c=18e4;a.ws.addEventListener("message",function(){b&&clearTimeout(b),b=setTimeout(function(){a.closeFlag||a.reuseFlag||(a.reuseFlag=!0,a.ec.emit(k.reuse))},c)}),a.ec.on(k.close+" session-closed",function(){a.closeFlag||a.reuseFlag||(a.reuseFlag=!0,a.ec.emit(k.reuse))})}},j.connect=function(a,b){var c=b.server;if(!(c&&i.now()<=c.expires))throw a.ec.emit(k.error),new Error("WebSocket connet failed.");j.createSocket(a,c.server)},j.getServer=function(a,b,c){var f=b.appId,g=b.secure,h="",j="http://";d.location&&"https:"===d.location.protocol&&g&&(j="https://");var l="";switch(b.region){case"cn":l="g0";break;case"us":l="a0";break;default:throw new Error("There is no this region.")}h=j+"router-"+l+"-push.leancloud.cn/v1/route?_t="+i.now()+"&appId="+f,g&&(h+="&secure=1"),e.get(h).end(function(b,d){if(d.ok){var e=d.body;e.expires=i.now()+1e3*e.ttl,a.server=e,c(e)}else a.ec.emit(k.error)})},j.openSession=function(a,b){var c={cmd:"session",op:"open",appId:a.options.appId,ua:"js/"+g,i:b.serialId};a.authFun?a.authFun({clientId:a.options.peerId},function(b){if(!b||!b.signature)throw new Error("Session open denied by application: "+b);c.n=b.nonce,c.t=b.timestamp,c.s=b.signature,j.wsSend(a,a.cmd)}):j.wsSend(a,c)},j.closeSession=function(a){j.wsSend(a,a,{cmd:"session",op:"close"})},j.startConv=function(a,b){var c={cmd:"conv",op:"start",m:b.members,attr:{name:b.name||"",attr:b.attr||{}},i:b.serialId,"transient":b["transient"]||!1};a.authFun?a.authFun({clientId:a.options.peerId,members:b.members},function(b){if(!b||!b.signature)throw new Error("Conversation creation denied by application: "+b);c.n=b.nonce,c.t=b.timestamp,c.s=b.signature,j.wsSend(a,c)}):j.wsSend(a,c)},j.convAdd=function(a,b){var c={cmd:"conv",op:"add",cid:b.cid,m:b.members,i:b.serialId};a.authFun?a.authFun({clientId:a.options.peerId,members:b.members,convId:b.cid,action:"invite"},function(b){if(!b||!b.signature)throw new Error("Adding members to conversation denied by application: "+b);c.n=b.nonce,c.t=b.timestamp,c.s=b.signature,j.wsSend(a,c)}):j.wsSend(a,c)},j.convRemove=function(a,b){var c={cmd:"conv",op:"remove",cid:b.cid,m:b.members,i:b.serialId};a.authFun&&(b.members.length>1||b.members[0]!=a.options.peerId)?a.authFun({clientId:a.options.peerId,members:b.members,convId:b.cid,action:"kick"},function(b){if(!b||!b.signature)throw new Error("Removing members from conversation denied by application: "+b);c.n=b.nonce,c.t=b.timestamp,c.s=b.signature,j.wsSend(a,c)}):j.wsSend(a,c)},j.send=function(a,b){j.wsSend(a,{cmd:"direct",cid:b.cid,msg:b.data,i:b.serialId,r:b.receipt||!1,"transient":b["transient"]||!1})},j.convQuery=function(a,b){b=b||{},j.wsSend(a,{cmd:"conv",op:"query",where:b.where||{m:a.options.peerId},sort:b.sort||"-lm",limit:b.limit||10,skip:b.skip||0,i:b.serialId})},j.querySession=function(a,b){j.wsSend(a,{cmd:"session",op:"query",i:b.serialId,sessionPeerIds:b.peerIdList})},j.convLog=function(a,b){j.wsSend(a,{cmd:"logs",cid:b.cid,t:b.t||void 0,mid:b.mid||void 0,limit:b.limit||20,i:b.serialId})},j.convUpdate=function(a,b){j.wsSend(a,{cmd:"conv",op:"update",cid:b.cid,attr:b.data,i:b.serialId})},j.convAck=function(a,b){j.wsSend(a,{cmd:"ack",cid:b.cid,mid:b.mid})},j.convCount=function(a,b){j.wsSend(a,{cmd:"conv",op:"count",i:b.serialId,cid:b.cid})},j.getMediaMsg=function(a,b){if(!i.isJSONString(b))return a.options.encodeHTML&&(b=i.encodeHTML(b)),b;if(b=JSON.parse(b),!b.hasOwnProperty("_lctype"))return b;var c={text:b._lctext,attr:b._lcattrs};switch(a.options.encodeHTML&&(c.text=i.encodeHTML(b._lctext)),b._lcfile&&b._lcfile.url&&(c.url=b._lcfile.url),b._lcfile&&b._lcfile.metaData&&(c.metaData=b._lcfile.metaData),b._lctype){case-1:c.type="text";break;case-2:c.type="image";break;case-3:c.type="audio";break;case-4:c.type="video";break;case-5:c.type="location";break;case-6:c.type="file"}return c},j.setMediaMsg=function(a,b,c){var d;if("text"!==b&&!c.metaData)throw new Error("Media Data must have metaData attribute.");switch(b){case"text":d={_lctype:-1,_lctext:c.text,_lcattrs:c.attr};break;case"image":d={_lctype:-2,_lctext:c.text,_lcattrs:c.attr,_lcfile:{url:c.url,objId:c.objectId,metaData:{name:c.metaData.name,format:c.metaData.format,height:c.metaData.height,width:c.metaData.width,size:c.metaData.size}}};break;case"audio":d={_lctype:-3,_lctext:c.text,_lcattrs:c.attr,_lcfile:{url:c.url,objId:c.objectId,metaData:{name:c.metaData.name,format:c.metaData.format,duration:c.metaData.duration,size:c.metaData.size}}};break;case"video":d={_lctype:-4,_lctext:c.text,_lcattrs:c.attr,_lcfile:{url:c.url,objId:c.objectId,metaData:{name:c.metaData.name,format:c.metaData.format,duration:c.metaData.duration,size:c.metaData.size}}};break;case"location":d={_lctype:-5,_lctext:c.text,_lcattrs:c.attr,_lcloc:{longitude:c.metaData.longitude,latitude:c.metaData.latitude}};break;case"file":d={_lctype:-6,_lctext:c.text,_lcattrs:c.attr,_lcfile:{name:c.metaData.name,size:c.metaData.size}}}return d=JSON.stringify(d)},j.getSerialId=function(a){return a.serialId++,a.serialId>999999&&(a.serialId=2015),a.serialId},j.bindEvent=function(a){a.openFlag||(a.ec.on("session-opened",function(b){a.reuseFlag=!1,a.openFlag=!0,a.ec.emit(k.open,b)}),a.ec.on("session-error",function(b){a.ec.emit(k.error,b)}),a.ec.on("conv-joined",function(b){b.peerId!==b.initBy&&a.ec.emit(k.join,b)}),a.ec.on("conv-left",function(b){a.ec.emit(k.left,b)}),a.ec.on("conv-members-joined",function(b){a.ec.emit(k.join,b)}),a.ec.on("conv-members-left",function(b){a.ec.emit(k.left,b)}),a.ec.on("conv-error",function(b){throw a.ec.emit(k.error,b),b.code+":"+b.reason}),a.ec.on("direct",function(b){b.msg=j.getMediaMsg(a,b.msg),b["transient"]||j.convAck(a,{cid:b.cid,mid:b.id}),a.ec.emit(k.message,b)}),a.ec.on("rcp",function(b){a.ec.emit(k.receipt,b)}))},i.noop=function(){},i.isJSONString=function(a){return/^\{.*\}$/.test(a)},i.now=function(){return(new Date).getTime()},i.encodeHTML=function(a){var b=function(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):a};if("object"==typeof a){for(var c in a)a[c]=i.encodeHTML(a[c]);return a}return b(a)},i.eventCenter=function(){function a(a){var b=[],c=0,d=a.length;if(d){for(;d>c;c++)a[c]&&b.push(a[c]);return b}return null}var b={},c={},d=function(a,d,e){if(!a)throw new Error("No event name.");if(!d)throw new Error("No callback function.");var f,g,h,i=a.split(/\s+/);e&&(g=e.once,h=e.single),f=g?c:b;for(var j=0,k=i.length;k>j;j++)if(i[j]){var l=f[i[j]];if(l||(l=[],f[i[j]]=l),h){for(var m=!1,n=0,o=l.length;o>n;n++)if(l[n].toString()===d.toString()){m=!0;break}m||l.push(d)}else l.push(d)}},e=function(a,d,e){var f,g;if(e&&(g=e.once),f=g?c:b,f[a])for(var h=0,i=f[a].length;i>h;h++)if(f[a][h]===d){f[a][h]=null;break}};return{on:function(a,b){return d(a,b),this},once:function(a,b){return d(a,b,{once:!0}),this},_one:function(a,b){d(a,b,{single:!0})},emit:function(d,f){if(!d)throw new Error("No emit event name.");var g=0,h=0;if(b[d]){for(g=0,h=b[d].length;h>g;g++)b[d][g]&&b[d][g].call(this,f);b[d]=a(b[d])}if(c[d]){for(g=0,h=c[d].length;h>g;g++)c[d][g]&&(c[d][g].call(this,f),e(d,c[d][g],{once:!0}));c[d]=a(c[d])}return this},off:function(a,b){return e(a,b),this}}},"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=n),c.realtime=n):"function"==typeof define&&define.amd&&define("AV/realtime",[],function(){return n})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{extend:1,superagent:2}]},{},[5,6]);